$("#leftmenu ul").hide();$("#menu_forums").show();$(".navon").removeClass("navon");$("#header_forums").parents("li").addClass("navon");$(".tabon").removeClass("tabon");$("#menu_forums #"+GET("tpl")).eq(0).addClass("tabon");if(parent.$("admincpnav"))parent.$("admincpnav").innerHTML='\u8bba\u575b\x26nbsp;\x26raquo;\x26nbsp;\u7f16\u8f91\u7248\u5757\x26nbsp;\x26nbsp;\x3ca target\x3d"main" title\x3d"\u6dfb\u52a0\u5230\u5e38\u7528\u64cd\u4f5c" href\x3d"javascript:addCustommenu(\'\u7f16\u8f91\u7248\u5757\',\'forums_edit\')"\x3e[+]\x3c/a\x3e';var currentAnchor="basic";var icon;function modifystate(custom){var trObj=custom.parentNode.parentNode;var inputsObj=trObj.getElementsByTagName("input");for(key in inputsObj){var obj=inputsObj[key];if(typeof obj=="object"&&obj.type!="checkbox"){obj.value="";obj.readOnly=custom.checked?false:true;obj.style.display=obj.readOnly?"none":""}}}var rowtypedata=[[[1,"","td25"],[1,'\x3cinput type\x3d"text" size\x3d"2" name\x3d"newdisplayorder[]" value\x3d"0" /\x3e'],[1,'\x3cinput type\x3d"text" name\x3d"newname[]" /\x3e'],[1,'\x3cinput type\x3d"text" name\x3d"newicon[]" /\x3e'],[1,'\x3cinput type\x3d"hidden" name\x3d"newenable[]" value\x3d"1"\x3e\x3cinput type\x3d"checkbox" class\x3d"checkbox" checked\x3d"checked" disabled /\x3e'],[1,'\x3cinput type\x3d"hidden" name\x3d"newmoderators[]" value\x3d"0"\x3e\x3cinput type\x3d"checkbox" class\x3d"checkbox" disabled /\x3e'],[1,""]],[[1,"","td25"],[1,'\x3cinput name\x3d"newextension[]" type\x3d"text" class\x3d"txt" size\x3d"10"\x3e',"td24"],[1,'\x3cinput name\x3d"newmaxsize[]" type\x3d"text" class\x3d"txt" size\x3d"15"\x3e']]];function foruminsertunit(text,textend){insertunit($("formulapermnew"),text,textend);formulaexp()}if(GET("anchor")!="")showanchor($("nav_"+GET("anchor")));var formulafind=new Array("digestposts","posts");var formulareplace=new Array("\x3cu\x3e\u7cbe\u534e\u5e16\u6570\x3c/u\x3e","\x3cu\x3e\u53d1\u5e16\u6570\x3c/u\x3e");function formulaexp(){var result=$("formulapermnew").value;result=result.replace(/extcredits1/g,"\x3cu\x3e\u5a01\u671b\x3c/u\x3e");result=result.replace(/extcredits2/g,"\x3cu\x3e\u91d1\u94b1\x3c/u\x3e");result=result.replace(/extcredits3/g,"\x3cu\x3e\u8d21\u732e\x3c/u\x3e");result=result.replace(/extcredits4/g,"\x3cu\x3e\u81ea\u5b9a\u4e49\u79ef\u52064\x3c/u\x3e");result=result.replace(/extcredits5/g,"\x3cu\x3e\u81ea\u5b9a\u4e49\u79ef\u52065\x3c/u\x3e");result=result.replace(/extcredits6/g,"\x3cu\x3e\u81ea\u5b9a\u4e49\u79ef\u52066\x3c/u\x3e");result=result.replace(/extcredits7/g,"\x3cu\x3e\u81ea\u5b9a\u4e49\u79ef\u52067\x3c/u\x3e");result=result.replace(/extcredits8/g,"\x3cu\x3e\u81ea\u5b9a\u4e49\u79ef\u52068\x3c/u\x3e");result=result.replace(/regdate/g,"\x3cu\x3e\u6ce8\u518c\u65f6\u95f4\x3c/u\x3e");result=result.replace(/regday/g,"\x3cu\x3e\u6ce8\u518c\u5929\u6570\x3c/u\x3e");result=result.replace(/regip/g,"\x3cu\x3e\u6ce8\u518cIP\x3c/u\x3e");result=result.replace(/lastip/g,"\x3cu\x3e\u6700\u540e\u767b\u5f55IP\x3c/u\x3e");result=result.replace(/buyercredit/g,"\x3cu\x3e\u4e70\u5bb6\u4fe1\u7528\u8bc4\u4ef7\x3c/u\x3e");result=result.replace(/sellercredit/g,"\x3cu\x3e\u5356\u5bb6\u4fe1\u7528\u8bc4\u4ef7\x3c/u\x3e");result=result.replace(/digestposts/g,"\x3cu\x3e\u7cbe\u534e\u5e16\u6570\x3c/u\x3e");result=result.replace(/posts/g,"\x3cu\x3e\u53d1\u5e16\u6570\x3c/u\x3e");result=result.replace(/threads/g,"\x3cu\x3e\u4e3b\u9898\u6570\x3c/u\x3e");result=result.replace(/oltime/g,"\x3cu\x3e\u5728\u7ebf\u65f6\u95f4(\u5c0f\u65f6)\x3c/u\x3e");result=result.replace(/and/g,"\x26nbsp;\x26nbsp;\x3cb\x3e\u5e76\u4e14\x3c/b\x3e\x26nbsp;\x26nbsp;");result=result.replace(/or/g,"\x26nbsp;\x26nbsp;\x3cb\x3e\u6216\u8005\x3c/b\x3e\x26nbsp;\x26nbsp;");result=result.replace(/>=/g,"\x26ge;");result=result.replace(/<=/g,"\x26le;");result=result.replace(/==/g,"\x3d");$("formulapermexp").innerHTML=result}formulaexp();_attachEvent(document.documentElement,"keydown",function(e){entersubmit(e,"detailsubmit")});$("#filele_0").change(function(event){var file=$(this).prop("files");if(file.length>0){if(file[0].type!="image/jpeg"&&file[0].type!="image/png"){showDialog("\u53ea\u652f\u6301jpg\u4e0epng\u683c\u5f0f");return}var reader=new FileReader;reader.readAsArrayBuffer(file[0]);reader.onload=function(evt){icon=new Uint8Array(evt.target.result);var html='\x3clabel\x3e\x3cinput type\x3d"checkbox" class\x3d"checkbox" name\x3d"deleteicon" value\x3d"yes"\x3e \u5220\u9664\x3c/label\x3e\x3cbr\x3e\x3cimg id\x3d"filele_0_img" src\x3d"'+showimg(icon)+'" onload\x3d"$(\'input[name\x3d\x26quot;Extranew.Iconwidth\x26quot;]\').val($(\'filele_0_img\').width)" width\x3d"80px"\x3e\x3cbr\x3e';$("#filele_0").parent().parent().find(".tips2").html(html)}}});$('input[name\x3d"Threadtypesnew.Status"]').each(function(index,el){if($(this).parent().hasClass("checked"))$(this).click()});$("#cpform").submit(function(event){var obj={};obj.Fid=GET("Fid");switch($('input[name\x3d"anchor"]').val()){case "basic":obj.Name=$('input[name\x3d"Namenew"]').val();obj.Extranew={Namecolor:$('input[name\x3d"Extranew.Namecolor"]').val(),Iconwidth:80};obj.Fup=$('select[name\x3d"fupnew"]').val();obj.Forumcolumns=$('input[name\x3d"Forumcolumnsnew"]').val();obj.Catforumcolumns=$('input[name\x3d"Catforumcolumnsnew"]').val();obj.Icon=$('input[name\x3d"Forumcolumnsnew"]').val();$('input[name\x3d"Statusnew"]').each(function(index,el){if($(this).parent().hasClass("checked"))obj.Status=$(this).val()});$('input[name\x3d"Recommendnew"]').each(function(index,el){if($(this).parent().hasClass("checked"))obj.Recommend=$(this).val()});obj.Description=$('textarea[name\x3d"Descriptionnew"]').val();obj.Rules=$('textarea[name\x3d"Rulesnew"]').val();obj.Catlist=[];obj.Icon=tpldata.Base.Icon;obj.File=icon;ajax_post(WRITE_MSG_admin_forum_edit_base(obj),function(res){showDialog("\u64cd\u4f5c\u6210\u529f","right","\u63d0\u4ea4\u7ed3\u679c",function(){toggleMenu(header_key,GET("tpl"))})});break;case "threadtypes":$('input[name\x3d"Threadtypesnew.Status"]').each(function(index,el){if($(this).parent().hasClass("checked"))obj.Status=$(this).val()});$('input[name\x3d"Threadtypesnew.Required"]').each(function(index,el){if($(this).parent().hasClass("checked"))obj.Required=$(this).val()});$('input[name\x3d"Threadtypesnew.Listable"]').each(function(index,el){if($(this).parent().hasClass("checked"))obj.Listable=$(this).val()});$('input[name\x3d"Threadtypesnew.Prefix"]').each(function(index,el){if($(this).parent().hasClass("checked"))obj.Prefix=$(this).val()});obj.Add=[];for(var i=0;i<$('input[name\x3d"newdisplayorder[]"]').length;i++){var type={};type.Displayorder=$('input[name\x3d"newdisplayorder[]"]').eq(i).val();type.Name=$('input[name\x3d"newname[]"]').eq(i).val();type.Icon=$('input[name\x3d"newicon[]"]').eq(i).val();type.Enable=$('input[name\x3d"newenable[]"]').eq(i).val();type.Moderators=$('input[name\x3d"newmoderators[]"]').eq(i).val();console.log(type);obj.Add.push(type)}obj.Types=[];obj.Deletes=[];for(var i=0;i<$('input[name\x3d"threadtypesnew[options][delete][]"]').length;i++){var id=$('input[name\x3d"threadtypesnew[options][delete][]"]').eq(i).val();if($('input[name\x3d"threadtypesnew[options][delete][]"]').prop("checked")){obj.Deletes.push(id);continue}var type={};type.Id=id;type.Displayorder=$('input[name\x3d"threadtypesnew[options][displayorder]['+id+']"]').val();type.Name=$('input[name\x3d"threadtypesnew[options][name]['+id+']"]').val();type.Icon=$('input[name\x3d"threadtypesnew[options][icon]['+id+']"]').val();type.Enable=$('input[name\x3d"threadtypesnew[options][enable]['+id+']"]').val();type.Moderators=$('input[name\x3d"threadtypesnew[options][moderators]['+id+']"]').val();obj.Types.push(type)}ajax_post(WRITE_MSG_admin_forum_threadtypes(obj),function(res){showDialog("\u64cd\u4f5c\u6210\u529f","right","\u63d0\u4ea4\u7ed3\u679c",function(){})});break;default:showDialog("\u672a\u5904\u7406")}return false});