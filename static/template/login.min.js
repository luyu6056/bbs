websocket_func[CMD_MSG_WS2U_ChangeBind]=function(a){var c=loadUserdata("login_ref").match(/tpl=([^&]+)/),b="";c?"login"==c[1]?b="/index.html":b="/index.html"+loadUserdata("login_ref"):b="/index.html";f=function(){location.href=b};1!=a.Result?void 0==err[a.Result]?showDialog("\u672a\u77e5\u9519\u8bef: "+a.Result,"alert","\u7ed1\u5b9a\u5931\u8d25",f):showDialog(err[a.Result],"alert","\u7ed1\u5b9a\u5931\u8d25",f):showDialog(a.Msg,"notice","\u7ed1\u5b9a\u6210\u529f",f)};cache.Head.Uid&&""==GET("Type")?tpl_load("forum_index",WRITE_MSG_U2WS_forum_index,{}):(document.title="\u767b\u5f55 - "+cache.Head.Bbname,$("#loginform2").submit(function(a){checkseccode(sceneLogin,function(a){name=$('input[name\x3d"loginusername"]').val();websocket_func[CMD_MSG_WS2U_Login_Gethash]=function(b){seccode_scene[sceneLogin].reset();b=CryptoJS.SHA256(CryptoJS.MD5($('input[name\x3d"loginpasswd"]').val()+b.Hash2).toString()+b.Hash).toString();websocket_func[CMD_MSG_WS2U_UserLogin]=function(a){if(1==a.Result){token=[];str="";for(var b=0;b<a.Token.length;b++)str+=String.fromCharCode(a.Token[b]),token.push(a.Token[b]);saveUserdata("token",str);var b=loadUserdata("login_ref").match(/tpl=([^&]+)/),c="";b?"login"==b[1]?c="/index.html":c="/index.html"+loadUserdata("login_ref"):c="/index.html";cache.Head=a.Head;setHead(cache.Head);setTimeout("window.location.href \x3d'"+c+"';",3E3);$("login_succeedmessage").href=c;$(".mn").hide();$("login_succeed").style.display="";cache.Head=a.Head;$("loginsucceedlocation").innerHTML="\u6b22\u8fce\u60a8\u56de\u6765\uff0c"+a.Head.Grouptitle+" "+a.Head.Username+"\uff0c\u73b0\u5728\u5c06\u8f6c\u5165\u767b\u5f55\u524d\u9875\u9762"}else void 0==err[a.Result]?showDialog("\u672a\u77e5\u9519\u8bef: "+a.Result):showDialog(err[a.Result],"alert","\u767b\u5f55\u5931\u8d25")};ajax_post(WRITE_MSG_U2WS_UserLogin({Username:name,Passwd:b,Seccode:a}))};ajax_post(WRITE_MSG_U2WS_Login_Gethash({Name:name}))});return!1}),loginreload=function(){history.pushState(h5state,null,document.location.href.replace("\x26Type\x3dQQ","").replace(/&Code=[^&]+/,"").replace(/&State=[^&]+/,""));reload()},"QQ"==GET("Type")&&jQuery.ajax({url:"https://graph.qq.com/oauth2.0/me",type:"get",data:{access_token:GET("access_token")},dataType:"jsonp",jsonp:"callback",jsonpCallback:"callback",success:function(a){a.error?showDialog("\u8bf7\u91cd\u65b0\u767b\u5f55\uff0c\u9519\u8bef\u4ee3\u7801\x3cbr\x3e"+a.error,"alert","\u767b\u5f55\u5931\u8d25",loginreload):a.client_id&&a.openid?cache.Head.Uid?ajax_post(WRITE_MSG_U2WS_ChangeBind({Type:GET("Type"),Openid:a.openid,State:GET("state"),Access_token:GET("access_token")})):ajax_post(WRITE_MSG_U2WS_QQLogin({State:GET("state"),Openid:a.openid})):showDialog("\u65e0\u6cd5\u767b\u5f55,\u8bf7\u622a\u56fe\u8054\u7cfb\u7ba1\u7406\u5458,\u539f\u56e0:\u65e0\u6cd5\u83b7\u53d6client_id\u548copenid","alert","QQ\u767b\u5f55\u5931\u8d25",loginreload)}}),websocket_func[CMD_MSG_WS2U_QQLogin]=function(a){console.log(a);if(1==a.Result)if(a.Head.Uid){cache.Head=a.Head;setHead(cache.Head);var c=loadUserdata("login_ref").match(/tpl=([^&]+)/),b="";c?"login"==c[1]?b="/index.html":b="/index.html"+loadUserdata("login_ref"):b="/index.html";setTimeout("window.location.href \x3d'"+b+"';",3E3);$("login_succeedmessage").href=b;$(".mn").hide();$("login_succeed").style.display="";$("loginsucceedlocation").innerHTML="\u6b22\u8fce\u60a8\u56de\u6765\uff0c"+a.Head.Grouptitle+" "+a.Head.Username+"\uff0c\u73b0\u5728\u5c06\u8f6c\u5165\u767b\u5f55\u524d\u9875\u9762"}else tpl_load("bindaccount",WRITE_MSG_U2WS_tpl_success,{Type:"QQ",Openid:a.Openid,State:GET("state"),Access_token:GET("access_token")});else void 0==err[a.Result]?showDialog("\u672a\u77e5\u9519\u8bef: "+a.Result,"alert","\u767b\u5f55\u5931\u8d25",loginreload):showDialog(err[a.Result],"alert","\u767b\u5f55\u5931\u8d25",loginreload)});