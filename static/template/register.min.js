cache.Head.Uid&&(location.href="/");var strongpw=[],pwlength=6,ignoreEmail=!1;function showBBRule(){showDialog($("layer_bbrule").innerHTML,"info","Discuz! Board1 \u7f51\u7ad9\u670d\u52a1\u6761\u6b3e");$("fwin_dialog_close").style.display="none"}var lastusername="",lastpassword="",lastemail="",lastinvitecode="",stmp=[],modifypwd=!1,profileTips="\u5982\u4e0d\u9700\u8981\u66f4\u6539\u5bc6\u7801\uff0c\u6b64\u5904\u8bf7\u7559\u7a7a";function errormessage(a,b){if($(a)){try{showInputTip()}catch(c){}b=b?b:"";$("tip_"+a)&&("succeed"==b?(b="",$("tip_"+a).parentNode.className=$("tip_"+a).parentNode.className.replace(/ p_right/,""),$("tip_"+a).parentNode.className+=" p_right"):""!==b&&($("tip_"+a).parentNode.className=$("tip_"+a).parentNode.className.replace(/ p_right/,"")));$("chk_"+a)&&($("chk_"+a).innerHTML=b);$(a).className=$(a).className.replace(/ er/,"");$(a).className+=b?" er":""}}function addFormEvent(a,b){var c=0,d=$(a).getElementsByTagName("input");for(i=0;i<d.length;i++)if(""==d[i].name&&(d[i].name=d[i].id,stmp[c]=i,c++),"text"==d[i].type||"password"==d[i].type)d[i].onfocus=function(){showInputTip(this.id?this.id:this.name)};if(c){d[stmp[0]].onblur=function(){checkusername(d[stmp[0]].id)};checkPwdComplexity(d[stmp[1]],d[stmp[2]]);try{ignoreEmail||addMailEvent(d[stmp[3]])}catch(e){}try{b?$("invitecode").focus():d[stmp[0]].focus()}catch(e){}}}function checkPwdComplexity(a,b,c){modifypwd=c||!1;a.onblur=function(){if(""==a.value){var d=modifypwd?profileTips:"\u8bf7\u586b\u5199\u5bc6\u7801";0<pwlength&&(d+=", \u6700\u5c0f\u957f\u5ea6\u4e3a "+pwlength+" \u4e2a\u5b57\u7b26");errormessage(a.id,d)}else errormessage(a.id,modifypwd?"":"succeed");checkpassword(a.id,b.id)};a.onkeyup=function(){if(0==pwlength||$(a.id).value.length>=pwlength){var b=checkstrongpw(a.id);errormessage(a.id,'\x3cspan class\x3d"passlevel passlevel'+b+'"\x3e\u5bc6\u7801\u5f3a\u5ea6:'+["","\u5f31","\u4e2d","\u5f3a"][b]+"\x3c/span\x3e")}};b.onblur=function(){""==b.value&&errormessage(b.id,modifypwd?profileTips:"\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801");checkpassword(a.id,b.id)}}function addMailEvent(a){a.onclick=function(b){emailMenu(b,a.id)};a.onkeyup=function(b){emailMenu(b,a.id)};a.onkeydown=function(b){emailMenuOp(4,b,a.id)};a.onblur=function(){""==a.value&&errormessage(a.id,"\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740");emailMenuOp(3,null,a.id)};stmp.email=a.id}function checkstrongpw(a){var b=0;$(a).value.match(/\d+/g)&&b++;$(a).value.match(/[a-z]+/ig)&&b++;$(a).value.match(/[^a-z0-9]+/ig)&&b++;return b}function showInputTip(a){var b=$("registerform").getElementsByTagName("i");for(i=0;i<b.length;i++)"p_tip"==b[i].className&&(b[i].style.display="none");$("tip_"+a)&&($("tip_"+a).style.display="block")}function showbirthday(){var a=$("birthday"),b=a.value;a.length=0;a.options.add(new Option("\u65e5",""));for(var c=0;28>c;c++)a.options.add(new Option(c+1,c+1));if("2"!=$("birthmonth").value)switch(a.options.add(new Option(29,29)),a.options.add(new Option(30,30)),$("birthmonth").value){case "1":case "3":case "5":case "7":case "8":case "10":case "12":a.options.add(new Option(31,31))}else""!=$("birthyear").value&&(c=$("birthyear").value,(0==c%400||0==c%4&&0!=c%100)&&a.options.add(new Option(29,29)));a.value=b}function trim(a){return a.replace(/^\s*(.*?)[\s\n]*$/g,"$1")}var emailMenuST=null,emailMenui=0,emaildomains="qq.com 163.com sina.com sohu.com yahoo.com gmail.com hotmail.com".split(" ");function emailMenuOp(a,b,c){3==a&&BROWSER.ie&&7>BROWSER.ie&&checkemail(c);if($("emailmore_menu"))if(1==a)$("emailmore_menu").style.display="none";else if(2==a)showMenu({ctrlid:"emailmore",pos:"13!"});else if(3==a)emailMenuST=setTimeout(function(){emailMenuOp(1,c);checkemail(c)},500);else if(4==a){if(b=b?b:window.event,a=$(c),13==b.keyCode){var d=-1!=a.value.indexOf("@")?a.value.substring(0,a.value.indexOf("@")):a.value;a.value=d+"@"+emaildomains[emailMenui];doane(b)}}else if(5==a)for(b=$("emailmore_menu").getElementsByTagName("a"),i=0;i<b.length;i++)b[i].className=""}function emailMenu(a,b){if(!(BROWSER.ie&&7>BROWSER.ie)){a=a?a:window.event;var c=$(b);if(-1!=c.value.indexOf("@"))$("emailmore_menu").style.display="none";else{var d=a.keyCode,e=c.value;if(c.value.length){if(40==d)emailMenui++,emailMenui>=emaildomains.length&&(emailMenui=0);else if(38==d)emailMenui--,0>emailMenui&&(emailMenui=emaildomains.length-1);else if(13==d){$("emailmore_menu").style.display="none";return}$("emailmore_menu")||(menu=document.createElement("div"),menu.id="emailmore_menu",menu.style.display="none",menu.className="p_pop",menu.setAttribute("disautofocus",!0),$("append_parent").appendChild(menu));c="\x3cul\x3e";for(d=0;d<emaildomains.length;d++)c+='\x3cli\x3e\x3ca href\x3d"javascript:;" onmouseover\x3d"emailMenuOp(5)" '+(emailMenui==d?'class\x3d"a" ':"")+"onclick\x3d\"$(stmp['email']).value\x3dthis.innerHTML;display('emailmore_menu');checkemail(stmp['email']);\"\x3e"+e+"@"+emaildomains[d]+"\x3c/a\x3e\x3c/li\x3e";c+="\x3c/ul\x3e";$("emailmore_menu").innerHTML=c;emailMenuOp(2)}else emailMenuOp(1)}}}websocket_func[CMD_MSG_WSU2_Register]=function(a){cache.Head=a.Head;setHead(cache.Head);match=loadUserdata("login_ref").match(/tpl=([^&]+)/);a="";match?"login"==match[1]?a="/index.html":a="/index.html"+loadUserdata("login_ref"):a="/index.html";setTimeout("window.location.href \x3d'"+$("reg_succeedmessage").href+"';",3E3);$("reg_succeedmessage").href=a;$(".mn").hide();$("reg_succeed").style.display="";$("reg_succeedmessage").innerHTML="\u611f\u8c22\u60a8\u6ce8\u518c "+cache.Head.Bbname+"\uff0c\u73b0\u5728\u5c06\u4ee5 "+cache.Head.Grouptitle+" \u8eab\u4efd\u767b\u5f55\u7ad9\u70b9"};$("#registerform").unbind().submit(function(a){a=$("registerform").getElementsByTagName("kbd");for(i=0;i<a.length;i++)"p_chk"==a[i].className&&(a[i].innerHTML="");a={};a.Username=$('input[name\x3d"regusername"]').val();a.Passwd=$('input[name\x3d"passwd"]').val();a.Email=$('input[name\x3d"regemail"]').val();a.Seccode=$('input[name\x3d"regseccodeverify"]').val();a.Type=GET("Type");a.Openid=GET("Openid");a.State=GET("State");a.Access_token=GET("Access_token");ajax_post(WRITE_MSG_U2WS_Register(a));return!1});function checkusername(a){errormessage(a);var b=trim($(a).value);if(!$("tip_"+a).parentNode.className.match(/ p_right/)||""!=b&&b!=lastusername)if(lastusername=b,b.match(/<|"/ig))errormessage(a,"\u7528\u6237\u540d\u5305\u542b\u654f\u611f\u5b57\u7b26");else{var c=b.replace(/[^\x00-\xff]/g,"**").length;3>c||15<c?errormessage(a,3>c?"\u7528\u6237\u540d\u4e0d\u5f97\u5c0f\u4e8e 3 \u4e2a\u5b57\u7b26":"\u7528\u6237\u540d\u4e0d\u5f97\u8d85\u8fc7 15 \u4e2a\u5b57\u7b26"):(websocket_func[CMD_MSG_WS2U_CheckRegister]=function(b){if(1==b.Result)$("#tip_"+a).parent().addClass("p_right");else switch(b.Result){case 0:errormessage(a,"\u7528\u6237\u540d\u5df2\u7ecf\u88ab\u6ce8\u518c");break;case -10:errormessage(a,"\u7528\u6237\u540d\u5305\u542b\u654f\u611f\u5b57\u7b26");break;default:console.log(b)}},ajax_post(WRITE_MSG_U2WS_CheckRegister({Type:1,Name:b})))}}function checkpassword(a,b){if($(a).value||$(b).value)if(0<pwlength&&$(a).value.length<pwlength)errormessage(a,"\u5bc6\u7801\u592a\u77ed\uff0c\u4e0d\u5f97\u5c11\u4e8e "+pwlength+" \u4e2a\u5b57\u7b26");else{if(strongpw){var c=!1,d=0,e=[],f;for(f in strongpw)1!==strongpw[f]||$(a).value.match(/\d+/g)||(c=!0,e[d]="\u6570\u5b57",d++),2!==strongpw[f]||$(a).value.match(/[a-z]+/g)||(c=!0,e[d]="\u5c0f\u5199\u5b57\u6bcd",d++),3!==strongpw[f]||$(a).value.match(/[A-Z]+/g)||(c=!0,e[d]="\u5927\u5199\u5b57\u6bcd",d++),4!==strongpw[f]||$(a).value.match(/[^A-Za-z0-9]+/g)||(c=!0,e[d]="\u7279\u6b8a\u7b26\u53f7",d++);if(c){errormessage(a,"\u5bc6\u7801\u592a\u5f31\uff0c\u5bc6\u7801\u4e2d\u5fc5\u987b\u5305\u542b "+e.join("\uff0c"));return}}errormessage(b);$(a).value!=$(b).value?errormessage(b,"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4"):errormessage(b,modifypwd?"":"succeed")}}function checkemail(a){errormessage(a);var b=trim($(a).value);if(!$(a).parentNode.className.match(/ p_right/)||""!=b&&b!=lastemail)lastemail=b,b.match(/<|"/ig)?errormessage(a,"Email \u5305\u542b\u654f\u611f\u5b57\u7b26"):(websocket_func[CMD_MSG_WS2U_CheckRegister]=function(b){if(1==b.Result)$("#tip_"+a).parent().addClass("p_right");else switch(b.Result){case 0:errormessage(a,"Email \u5df2\u7ecf\u88ab\u6ce8\u518c");break;case -10:errormessage(a,"Email \u5305\u542b\u654f\u611f\u5b57\u7b26")}},ajax_post(WRITE_MSG_U2WS_CheckRegister({Type:2,Name:b})))}switch(GET("Type")){case "QQ":ajax_post(WRITE_MSG_U2WS_BindAccount({Type:GET("Type"),Openid:GET("Openid"),State:GET("State"),Access_token:GET("Access_token")}))}websocket_func[CMD_MSG_WS2U_BindAccount]=function(a){console.log(a);1==a.Result&&($("#reg_avatar").attr("src",a.Img),$("#reg_nickname").text(a.Nickname),$("#regbind").show())};updateseccode("regseccodeverify",sceneReg,"click");document.title="\u7acb\u5373\u6ce8\u518c - "+cache.Head.Bbname;addFormEvent("registerform",0);