cache.Head.Uid&&(location.href="/");var strongpw=[],pwlength=6;function addFormEvent(a,b){var e=[],c=0,d=$(a).getElementsByTagName("input");for(i=0;i<d.length;i++)if(""==d[i].name&&(d[i].name=d[i].id,e[c]=i,c++),"text"==d[i].type||"password"==d[i].type)d[i].onfocus=function(){showInputTip(this.id?this.id:this.name)};c&&checkPwdComplexity(d[e[1]],d[e[2]])}function checkPwdComplexity(a,b,e){modifypwd=e||!1;a.onblur=function(){if(""==a.value){var c=modifypwd?profileTips:"\u8bf7\u586b\u5199\u5bc6\u7801";0<pwlength&&(c+=", \u6700\u5c0f\u957f\u5ea6\u4e3a "+pwlength+" \u4e2a\u5b57\u7b26");errormessage(a.id,c)}else errormessage(a.id,modifypwd?"":"succeed");checkpassword(a.id,b.id)};a.onkeyup=function(){if(0==pwlength||$(a.id).value.length>=pwlength){var b=checkstrongpw(a.id);errormessage(a.id,'\x3cspan class\x3d"passlevel passlevel'+b+'"\x3e\u5bc6\u7801\u5f3a\u5ea6:'+["","\u5f31","\u4e2d","\u5f3a"][b]+"\x3c/span\x3e")}};b.onblur=function(){""==b.value&&errormessage(b.id,modifypwd?profileTips:"\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801");checkpassword(a.id,b.id)}}function checkstrongpw(a){var b=0;$(a).value.match(/\d+/g)&&b++;$(a).value.match(/[a-z]+/ig)&&b++;$(a).value.match(/[^a-z0-9]+/ig)&&b++;return b}function showInputTip(a){var b=$("lostpwform").getElementsByTagName("i");for(i=0;i<b.length;i++)"p_tip"==b[i].className&&(b[i].style.display="none");$("tip_"+a)&&($("tip_"+a).style.display="block")}function trim(a){return a.replace(/^\s*(.*?)[\s\n]*$/g,"$1")}function checkpassword(a,b){if($(a).value||$(b).value)if(0<pwlength&&$(a).value.length<pwlength)errormessage(a,"\u5bc6\u7801\u592a\u77ed\uff0c\u4e0d\u5f97\u5c11\u4e8e "+pwlength+" \u4e2a\u5b57\u7b26");else{if(strongpw){var e=!1,c=0,d=[],f;for(f in strongpw)1!==strongpw[f]||$(a).value.match(/\d+/g)||(e=!0,d[c]="\u6570\u5b57",c++),2!==strongpw[f]||$(a).value.match(/[a-z]+/g)||(e=!0,d[c]="\u5c0f\u5199\u5b57\u6bcd",c++),3!==strongpw[f]||$(a).value.match(/[A-Z]+/g)||(e=!0,d[c]="\u5927\u5199\u5b57\u6bcd",c++),4!==strongpw[f]||$(a).value.match(/[^A-Za-z0-9]+/g)||(e=!0,d[c]="\u7279\u6b8a\u7b26\u53f7",c++);if(e){errormessage(a,"\u5bc6\u7801\u592a\u5f31\uff0c\u5bc6\u7801\u4e2d\u5fc5\u987b\u5305\u542b "+d.join("\uff0c"));return}}errormessage(b);$(a).value!=$(b).value?errormessage(b,"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4"):errormessage(b,modifypwd?"":"succeed")}}function errormessage(a,b){if($(a)){try{showInputTip()}catch(e){}b=b?b:"";$("tip_"+a)&&("succeed"==b?(b="",$("tip_"+a).parentNode.className=$("tip_"+a).parentNode.className.replace(/ p_right/,""),$("tip_"+a).parentNode.className+=" p_right"):""!==b&&($("tip_"+a).parentNode.className=$("tip_"+a).parentNode.className.replace(/ p_right/,"")));$("chk_"+a)&&($("chk_"+a).innerHTML=b);$(a).className=$(a).className.replace(/ er/,"");$(a).className+=b?" er":""}}updateseccode("seccode_resetpw",sceneResetpw);$("#lostpwform").unbind().submit(function(a){if(""==$('input[name\x3d"seccode_resetpw"]').val())return showDialog("\u8bf7\u5b8c\u6210\u9a8c\u8bc1"),!1;ajax_post(WRITE_MSG_U2WS_LostPW({Name:$("#lostpw_email2").val(),Seccode:$('input[name\x3d"seccode_resetpw"]').val()}));return!1});2==GET("Step")&&""!=GET("Email")&&($("#lostpw_email2").val(GET("Email")),bindstep2());function bindstep2(){$("#lostpw_email2").attr("disabled","disabled");$(".seccode").hide();$(".rfm").show();addFormEvent("lostpwform",0);$("#lostpwform").unbind().submit(function(a){if($("#passwd2").val()!=$("#passwd").val())return showDialog("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4"),!1;a=CryptoJS.MD5($("#emailseccode").val()).toString();ajax_post(WRITE_MSG_U2WS_ResetPW({Name:$("#lostpw_email2").val(),Passwd:aes_encrypt($("#emailseccode").val()+CryptoJS.MD5($("#passwd2").val()+a).toString(),a,CryptoJS.MD5($("#lostpw_email2").val()).toString())}));return!1})}websocket_func[CMD_MSG_WS2U_ResetPW]=function(a){showDialog("\u8bf7\u4f7f\u7528\u65b0\u5bc6\u7801\u767b\u5f55","right","\u4fee\u6539\u6210\u529f",function(){showWindowEx("login")})};websocket_func[CMD_MSG_WS2U_LostPW]=function(a){if(1==a.Result){showDialog("\u6211\u4eec\u5df2\u7ecf\u5411\u60a8\u7684\u7ed1\u5b9a\u90ae\u7bb1"+a.Email+"\u53d1\u9001\u4e86\u4e00\u5c01 \u9a8c\u8bc1\u7801\u90ae\u4ef6\uff0c\u8bf7\u60a8\u57283\u5206\u949f\u5185\u8f93\u5165\u6536\u5230\u7684\u9a8c\u8bc1\u7801","notice");var b=location.href.replace("\x26Step\x3d2","")+"\x26Step\x3d2",b=b.replace(/&Email=[^&]+/,"")+"\x26Email\x3d"+encodeURIComponent(a.Email);history.pushState(h5state,document.title,b);bindstep2()}else void 0==err[a.Result]?showDialog("\u672a\u77e5\u9519\u8bef: "+a.Result):showDialog(err[a.Result],"alert","\u767b\u5f55\u5931\u8d25"),updateseccode("seccode_resetpw",sceneResetpw)};